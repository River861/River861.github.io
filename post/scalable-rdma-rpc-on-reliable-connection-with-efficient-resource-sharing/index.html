<html>
<head>
    <meta charset="utf-8"/>
<meta name="description" content=""/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Scalable RDMA RPC on Reliable Connection with Efficient Resource Sharing | River&#39;s Blog</title>

<link rel="shortcut icon" href="https://river861.github.io/favicon.ico?v=1603978006198">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://river861.github.io/styles/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">

<script src="https://cdn.bootcss.com/highlight.js/9.15.10/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script>
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="å¤´åƒ">
        <div class="site-name gt-c-content-color-first">
            River&#39;s Blog
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
                <div class="nav-item">
                    
                        <a href="/" class="menu gt-a-link">
                            é¦–é¡µ
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/archives" class="menu gt-a-link">
                            å½’æ¡£
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/tags" class="menu gt-a-link">
                            æ ‡ç­¾
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/about" class="menu gt-a-link">
                            å…³äºæˆ‘
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/friends" class="menu gt-a-link">
                            å‹é“¾
                        </a>
                    
                </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1603978006198" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="æœç´¢æ–‡ç« " />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>

    <div class="post-container">
		<div class="post-content-wrapper">
			<div class="post-detail gt-bg-theme-color-second">
				<article class="gt-post-content">
					<h2 class="post-title">
					  Scalable RDMA RPC on Reliable Connection with Efficient Resource Sharing
					</h2>
					<div class="post-info">
					  <span>
						2020-10-28
					  </span>
					  <span>
						10 min read
					  </span>
					  
						<a href="https://river861.github.io/tag/Ebz-vAGbT/" class="post-tag">
						  # è®ºæ–‡ç¬”è®°
						</a>
					  
					</div>
					
					<div class="post-content">
						<p>è¿™ç¯‡è®ºæ–‡æå‡ºäº†ä¸¤ç§æ–¹æ³•æ¥æå‡RDMA RPCçš„Scalabilityï¼ˆå°±è¯‘ä½œå¯ä¼¸ç¼©æ€§å§ï¼‰ã€‚</p>
<!-- more -->
<h2 id="0-abstract">0 Abstract</h2>
<ul>
<li>
<p>å‘ç°é—®é¢˜ï¼šRDMAæŠ€æœ¯èƒ½ç»™åˆ†å¸ƒå¼ç³»ç»Ÿå¸¦æ¥ä½å»¶è¿Ÿå’Œé«˜å¸¦å®½ï¼Œä½†æ˜¯å½“ä¼ è¾“çš„targetæ•°ç›®å¢å¤šæ—¶ï¼ŒRCå‹çš„RDMAæ€§èƒ½ä¼šä¸‹é™ã€‚</p>
</li>
<li>
<p>æ€è€ƒé—®é¢˜ï¼šNIC cacheã€CPU cacheå’Œmemoryä¸­çš„èµ„æºç«äº‰ã€‚</p>
</li>
<li>
<p>è§£å†³é—®é¢˜ï¼š<br>
1. <strong>connection grouping</strong>ï¼šå°†connectionsè¿›è¡Œåˆ†ç»„ï¼Œæ¥è§£å†³NIC cacheçš„é¥±å’Œã€æŠ–åŠ¨é—®é¢˜ï¼›<br>
2. <strong>virtualized mapping</strong>ï¼šå°†æ‰€æœ‰connectionsç”¨åˆ°çš„æ¶ˆæ¯æ± æ˜ å°„åˆ°åŒä¸€ä¸ªç‰©ç†æ¶ˆæ¯æ± ä¸­ï¼Œæ¥è§£å†³CPU cacheçš„ä¸å‘½ä¸­é—®é¢˜ã€æé«˜memoryçš„åˆ©ç”¨ç‡ã€‚<br>
å°†åŸºäºä½¿ç”¨äº†ä¸Šè¿°æŠ€æœ¯çš„RCå‹RDMAçš„RPCç§°ä¸º<strong>ScaleRPC</strong>ã€‚</p>
</li>
<li>
<p>åº”ç”¨ï¼š<br>
1. åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ<br>
2. åˆ†å¸ƒå¼äº¤æ˜“ç³»ç»Ÿ</p>
</li>
</ul>
<h2 id="1-introduction">1 Introduction</h2>
<ol>
<li>DRMAæŠ€æœ¯è¢«å¹¿æ³›åº”ç”¨åˆ°å„ç±»å‹çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­</li>
<li>ç„¶è€Œåœ¨one-to-manyå‹çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå½“connectionsæ•°é‡å¢åŠ ï¼ˆå³clientæ•°ç›®å¢åŠ ï¼‰æ—¶ï¼ŒRDMAçš„throughputï¼ˆIOPSï¼‰ä¼šä¸‹é™</li>
<li>è¿™ç¯‡è®ºæ–‡æå‡ºçš„ScaleRPCé€šè¿‡ä¸‹é¢æ–¹å¼è§£å†³äº†é—®é¢˜ï¼š
<ul>
<li>å°†connectionsåˆ†æˆè‹¥å¹²ç»„ï¼Œç„¶åå°†å¯¹æ¯ä¸ªç»„é€šè¿‡åˆ†æ—¶æŠ€æœ¯ï¼ˆæ—¶é—´ç‰‡ï¼‰æ¥è°ƒåº¦æœåŠ¡ã€‚ï¼ˆè¿™æ ·å‡å°‘äº†åŒæ—¶æœåŠ¡çš„connectionsæ•°ç›®ï¼Œä»è€Œç¼“è§£NIC cacheçš„é¥±å’Œã€æŠ–åŠ¨ï¼‰</li>
<li>é€šè¿‡è™šæ‹Ÿæ˜ å°„æ¥æ—¶æ‰€æœ‰connectionsä½¿ç”¨åŒä¸€å—ç‰©ç†æ¶ˆæ¯æ± ï¼Œä»è€Œé™åˆ¶äº†ä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚ï¼ˆå‡å°‘äº†CPU LLC(Last Level Cache)çš„æŠ–åŠ¨ï¼‰</li>
</ul>
</li>
<li>è¿›ä¸€æ­¥éœ€è¦è€ƒè™‘çš„é—®é¢˜ï¼š</li>
</ol>
<ul>
<li>æ¯ä¸ªclientç»„å‘é€requestsçš„é¢‘ç‡æ˜¯ä¸åŒçš„ã€ä¼šå˜åŒ–çš„<br>
ğŸ‘‰ ä½¿ç”¨priority-based schedulingï¼ˆä¼˜å…ˆçº§è°ƒåº¦ï¼‰æ¥å®ç°clientç»„çš„è°ƒåº¦</li>
<li>è™šæ‹Ÿæ˜ å°„æ—¶ï¼Œä¸åŒç»„çš„çš„åˆ‡æ¢åº”è¯¥è¦è½»é‡ã€é«˜æ•ˆ<br>
ğŸ‘‰ é€šè¿‡ warm up æ¥å‡å°ç»„æ¶ˆæ¯æ± åˆ‡æ¢çš„å¼€é”€</li>
</ul>
<ol start="5">
<li>æœ¬è®ºæ–‡æ˜¯ä»ç³»ç»Ÿè§’åº¦è§£å†³é—®é¢˜ï¼Œè€Œä¸æ˜¯ç¡¬ä»¶è§’åº¦ã€‚ä½¿ç”¨DRAM-basedçš„RPCçš„åŸå› æ˜¯ï¼šæ›¿ä»£ä¸€ä¸ªç³»ç»Ÿçš„RPCå­ç³»ç»Ÿæ˜¯æ¯”è¾ƒçµæ´»çš„ã€‚</li>
<li>æ€»ç»“ä¸€ä¸‹ä¸»è¦çš„å·¥ä½œ
<ul>
<li>æå‡ºScaledRPCï¼›</li>
<li>é€šè¿‡æ¯”è¾ƒå®éªŒè¯„ä¼°äº†ScaledRPCï¼Œæ¯”è¾ƒå¯¹è±¡æ˜¯å½“å‰æœ€å…ˆè¿›çš„UDå‹çš„RDMA-based RPCsï¼›</li>
<li>è¿›ä¸€æ­¥éªŒè¯äº†ScaledRPCçš„ä¼¸ç¼©æ€§ï¼Œä¾‹å­ï¼šåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ç³»ç»Ÿã€‚</li>
</ul>
</li>
</ol>
<h2 id="2-background-and-motivation">2 Background and Motivation</h2>
<h3 id="21-rdma">2.1 RDMA</h3>
<ol>
<li>RDMAæ˜¯ä¸€ç§å®ç°äº†â€œç»•è¿‡osâ€å’Œâ€œé›¶æ‹·è´â€çš„è¿œç¨‹DMAæŠ€æœ¯ï¼Œå³èƒ½å¤Ÿç›´æ¥å’Œè¿œç«¯ä¸»æœºçš„å†…å­˜è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚åˆ†ä¸ºUDã€UCã€RCä¸‰ç§ï¼šUDæ”¯æŒone-to-oneå’Œone-to-manyï¼Œå¹¶ä¸”ä¸éœ€è¦å»ºç«‹ï¼›UCã€RCåˆ™åªæ”¯æŒone-to-oneï¼Œéœ€è¦å»ºç«‹connectionã€‚ä½†UDçš„MTUåªæœ‰4KBï¼Œè€ŒUCå’ŒRCçš„MTUæœ‰2GBã€‚UCå’ŒRCçš„åŒºåˆ«å°±æ˜¯å¯ä¸å¯é ã€‚</li>
<li>RDMAæœ‰ä¸¤ç§ç±»å‹çš„verbsï¼Œä¸€ç§æ˜¯å•è¾¹verbsï¼Œå³ä¸€ç«¯è¦sendï¼Œå¦ä¸€ç«¯è¦recvï¼Œéƒ½éœ€è¦CPUå‚ä¸ï¼›å¦ä¸€ç§æ˜¯åŒè¾¹verbsï¼Œå³ä¸éœ€è¦è¿œç«¯CPUçš„å‚ä¸ï¼Œç›´æ¥ä»æœ¬ç«¯read/writeè¿œç«¯ã€‚åªæœ‰RCæ‰èƒ½åŒæ—¶æ”¯æŒå•è¾¹ã€åŒè¾¹verbsï¼ŒUDåªæ”¯æŒå•è¾¹verbsã€‚</li>
</ol>
<h3 id="22-poor-scalability-of-rdma">2.2 Poor Scalability of RDMA</h3>
<figure data-type="image" tabindex="1"><img src="https://river861.github.io/post-images/1603889772899.PNG" alt="" loading="lazy"></figure>
<ol>
<li>å›¾1(a) æ˜¯one-to-manyåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªclientsåŒæ—¶å‘serverå‘é€è¯·æ±‚ï¼Œclientsæ•°é‡è¶Šå¤šæ—¶ï¼Œå¹³å‡ååç‡è¶Šä½</li>
<li>å›¾1(b) å°†ä»å¤šä¸ªclientså‘é€åˆ°serverç§°ä¸ºinboundï¼Œåè¿‡æ¥ç§°ä¸ºoutboundï¼Œå‘ç°ååç‡å—å½±å“çš„å®é™…ä¸Šæ˜¯RCçš„outbound writeã€‚</li>
</ol>
<h3 id="resource-contention-in-rdma">Resource Contention in RDMA</h3>
<figure data-type="image" tabindex="2"><img src="https://river861.github.io/post-images/1603892952511.PNG" alt="" loading="lazy"></figure>
<ol>
<li>outbound verbsé€ æˆäº†NIC cacheä¸Šçš„èµ„æºç«äº‰<br>
å½“connectionså¢åŠ æ—¶ï¼ŒNIC cacheä¸­å­˜å‚¨çš„QP stateså’ŒWQE cacheä¼šè¶…è¿‡å®¹é‡ï¼Œé€ æˆæŠ–åŠ¨ã€‚ï¼ˆNIC cacheä¼šå’ŒCPU LLCï¼ˆæ•°æ®å­˜æ”¾çš„å†…å­˜ï¼‰è¿›è¡Œâ€œæ¢é¡µâ€ï¼‰<br>
å¦‚å›¾3(a) ä¸­ï¼ŒPCIe Read Outæ¯”outbound RPCå¤šå¾—å¤šæ˜¯å› ä¸ºè¿›è¡Œäº†è®¸å¤šQP stateså’ŒWQE cacheçš„â€œæ¢è¿›â€ã€â€œæ¢å‡ºâ€ï¼›è€Œinbound RPCç¨³å®šã€PCIe Read Inå¾ˆä½çš„åŸå› æ˜¯ä»è¿œç«¯è¯»è¿›æ¥çš„æ•°æ®ç›´æ¥å­˜åˆ°äº†å†…å­˜ä¸­ï¼Œè€Œä¸éœ€è¦NICçš„å‚ä¸ã€‚</li>
<li>inbound verbsé€ æˆäº†CPU cacheä¸Šçš„èµ„æºç«äº‰<br>
å½“connectionså¢åŠ æ—¶ï¼ŒNICå‘CPU LLCå†™çš„æ•°æ®ä¼šè¶…è¿‡LLCå¤§å°ï¼Œé€ æˆwrite allocateï¼Œé™ä½æ•ˆç‡<br>
å¦‚å›¾3(b)ï¼ŒMessage box sizeè¶…è¿‡2kbè¡¨ç¤ºLLCè£…ä¸ä¸‹äº†ã€‚</li>
</ol>
<h2 id="3-scalerpc">3 ScaleRPC</h2>
<figure data-type="image" tabindex="3"><img src="https://river861.github.io/post-images/1603897333781.PNG" alt="" loading="lazy"></figure>
<h3 id="31-overview">3.1 Overview</h3>
<ol>
<li>Connection groupingï¼šå¯¹outboundçš„æ¶ˆæ¯è¿›è¡Œåˆ†ç»„ï¼ˆå¯èƒ½æ¥è‡ªä¸åŒclientsï¼‰ã€‚åœ¨ä¸€ä¸ªæ—¶é—´ç‰‡å†…åªä¼šåŒæ—¶å¤„ç†å½“å‰ç»„é‡Œçš„æ¶ˆæ¯ã€‚ä»è€Œé¿å…äº†æŠ–åŠ¨ã€‚</li>
<li>Virtualized mappingï¼šè°ƒåº¦connection groupsæ¥å…±äº«åŒä¸€å—ç‰©ç†æ¶ˆæ¯æ± <br>
RPCServerç»“ç‚¹åœ¨æ³¨å†Œæ—¶åˆ†é…è¿™å—æ¶ˆæ¯æ± ï¼Œè¿™å—æ¶ˆæ¯æ± åˆ†æˆå¾ˆå¤šæ¶ˆæ¯åŒºï¼ˆå¯¹åº”æ¯ä¸ªclientï¼‰ï¼Œæ¯ä¸ªæ¶ˆæ¯åŒºåˆ†æˆå¾ˆå¤šæ¶ˆæ¯å—ï¼ˆå¯¹åº”æ¯ä¸ªmessageï¼‰ã€‚æ¯ä¸ªæ¶ˆæ¯åŒºæœ‰ä¸€ä¸ªå·¥ä½œçº¿ç¨‹è½®è¯¢ï¼ˆpollï¼‰æ˜¯å¦æ”¶åˆ°äº†æ–°æ¶ˆæ¯ï¼Œæ˜¯çš„è¯å°±è¿›è¡Œå¤„ç†å¹¶é€šè¿‡RDMA writeå¯¹clientè¿›è¡Œè¿”å›ã€‚</li>
<li>ä¸‹ä¸€ç»„è¦å¤„ç†çš„connectionæå‰warm upã€‚</li>
</ol>
<h3 id="32-connection-grouping">3.2  Connection Grouping</h3>
<ol>
<li>åœ¨clientså‘é€æ¶ˆæ¯å‰ï¼Œserverå°±æŠŠclientsåˆ†æˆäº†ç»„ï¼Œç„¶åæŒ‰ç…§ round-robin çš„æ¨¡å¼è°ƒåº¦è¿™äº›ç»„ã€‚æ¯ä¸ªç»„å†…çš„clientså¯ä»¥åŒæ—¶å‘é€requestsåˆ°serverï¼Œè€Œä¸åŒç»„çš„clientså°†åœ¨ä¸åŒæ—¶é—´ç‰‡ä¸­è¢«æœåŠ¡ã€‚</li>
<li>ä½¿ç”¨<strong>ä¼˜å…ˆçº§è°ƒåº¦</strong>ã€‚æ¯ä¸ªclientçš„ä¼˜å…ˆçº§å®šä¹‰ä¸ºï¼šåœ¨ä¸€ä¸ªæ—¶é—´ç‰‡ä¸­çš„æ€»throughput / å¹³å‡çš„requestå¤§å°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‘é€requestè¶Šé¢‘ç¹çš„çš„clientçš„ä¼˜å…ˆçº§æ›´é«˜ã€‚æŠŠæœ‰ç›¸åŒä¼˜å…ˆçº§çš„clientåˆ†åˆ°åŒä¸€ç»„ä¸­ã€‚ä¼˜å…ˆçº§é«˜çš„ç»„å°†è¢«èµ‹äºˆæ›´å°‘çš„clientæ•°é‡å’Œæ›´é•¿çš„æ—¶é—´ç‰‡æ—¶é—´ï¼ˆå› ä¸ºå®ƒä»¬å‘requestæ›´é¢‘ç¹ï¼‰ã€‚</li>
<li>clientä¼šlog in/outï¼Œè¿™å¯¼è‡´groupçš„å¤§å°åŠ¨æ€å˜åŒ–ï¼Œå› æ­¤è®¾å®šäº†é˜ˆå€¼æ¥é€‚æ—¶åˆå¹¶æˆ–åˆ†è£‚groupã€‚</li>
<li>group sizeæ˜¯éœ€è¦æƒè¡¡çš„ï¼šè¿‡å°çš„è¯æ— æ³•è¾¾åˆ°æœ€é«˜æ•ˆç‡ï¼›è¿‡å¤§çš„è¯ä¼šå‡ºç°èµ„æºå†²çªã€‚</li>
</ol>
<h3 id="33-virtualized-mapping">3.3  Virtualized Mapping</h3>
<ol>
<li>clientå¢å¤šæ—¶ï¼ŒCPU LLCè£…ä¸ä¸‹æ‰€æœ‰çš„inbound messagesï¼Œè¿™å°†å¯¼è‡´write allocate(æ¢å…¥åˆ°ä½ä¸€çº§cache)ï¼Œä»è€Œä½¿æ•ˆç‡é™ä½ã€‚</li>
<li>message pool åªéœ€è¦è¶³å¤ŸæœåŠ¡ä¸€ä¸ªgroupçš„clientså°±å¯ä»¥äº†ï¼Œä¸‹ä¸€ä¸ªç»„å¯ä»¥ç›´æ¥è¦†ç›–ä¸Šä¸€ä¸ªç»„å†™åœ¨message pool ä¸­çš„ä¿¡æ¯ï¼Œä»è€Œå®ç°è™šæ‹Ÿæ˜ å°„ã€‚</li>
<li>å½“æ—¶é—´ç‰‡åˆ°æ—¶é—´ï¼Œè¦åˆ‡æ¢åˆ°å¦ä¸€ä¸ªç»„å‰ï¼Œä¼šæ¸…é™¤å½“å‰ç»„åœ¨message poolä¸­çš„requestsï¼Œç„¶åé€šè¿‡â€œæå¸¦â€çš„æ–¹å¼é€šçŸ¥ç»„å†…æ‰€æœ‰clientsï¼ˆå‘ç”Ÿäº†åˆ‡æ¢ï¼‰ã€‚ä¹‹åå°±å¼€å§‹åˆ‡æ¢ï¼šä¿å­˜å½“å‰ç»„çš„metadataï¼ˆclientIDsç­‰ï¼‰ï¼ŒåŠ è½½ä¸‹ä¸€ä¸ªç»„çš„metadataã€‚</li>
<li>warm upï¼šåœ¨åˆ‡æ¢æœåŠ¡çš„groupæ—¶ï¼Œæ–°çš„groupéœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´æ‰ä¼šæ”¶åˆ°requestï¼Œä¸ºäº†èŠ‚çœè¿™æ®µæ—¶é—´ï¼Œå¯ä»¥æå‰å¯¹è¦æœåŠ¡çš„ä¸‹ä¸€ä¸ªç»„è¿›è¡Œwarm upï¼ˆå¤§æ¦‚æ˜¯å¯ä»¥æå‰å¼€å§‹æ¥å—requestï¼‰ã€‚</li>
</ol>
<h3 id="34-putting-everything-togetheræ•´ä½“æµç¨‹">3.4  Putting Everything Togetherï¼ˆæ•´ä½“æµç¨‹ï¼‰</h3>
<figure data-type="image" tabindex="4"><img src="https://river861.github.io/post-images/1603966813906.PNG" alt="" loading="lazy"></figure>
<ol>
<li>æ¯ä¸ªclientå’Œserverè¿æ¥åï¼Œè¿›å…¥warm upçŠ¶æ€ï¼šrequestsåœ¨è‡ªå·±æœ¬åœ°åˆå§‹åŒ–ï¼›</li>
<li>æŠŠlocal requestsçš„ï¼ˆrequeståœ°å€ï¼Œbatchå¤§å°ï¼‰RDMA writeåˆ°serveçš„å†…å­˜E_jä¸­ï¼ˆjä¸ºclientIDï¼‰ï¼›</li>
<li>serveé€šè¿‡ä¼˜å…ˆçº§è°ƒåº¦å¯¹Eä¸­çš„requestsçš„clientsè¿›è¡Œåˆ†ç»„ã€è°ƒåº¦ï¼›</li>
<li>ç„¶åå¼€å§‹warm upï¼šå°†é€‰ä¸­çš„ä¸‹ä¸€ä¸ªç»„çš„clientsçš„requestsæ ¹æ®åœ°å€RDMA readåˆ°warm up poolä¸­ï¼›</li>
<li>å¼€å§‹ç»„åˆ‡æ¢æ—¶ï¼šå½“å‰warm up pool å˜æˆ process poolï¼ˆ<strong>è¿™é‡Œå¯¹åº”äºVirtualized mappingï¼Œå¯¹åº”äºä¸€ä¸ªgroup</strong>ï¼‰ï¼Œprocess poolå˜æˆwarm up poolï¼›æ–°çš„warm up pool å¼€å§‹æ–°çš„warm upã€‚</li>
<li>æ¯ä¸ªclientæœ‰ä¸€ä¸ªçŠ¶æ€æœºå›¾ï¼Œå½“ä¸€ä¸ªclientç¬¬ä¸€æ¬¡æ”¶åˆ°serverçš„å›åº”æ—¶ï¼Œå®ƒä»warm upå˜æˆprocessçŠ¶æ€ï¼Œå½“æ”¶åˆ°ç»„åˆ‡æ¢çš„æ¶ˆæ¯æ—¶ï¼Œåˆå˜æˆidleçŠ¶æ€ç„¶åéœ€è¦é‡æ–°ä»æœ¬åœ°åˆå§‹requestå¼€å§‹ï¼ˆæ­¥éª¤1ï¼‰ã€‚</li>
</ol>
<h3 id="35-deployment-considerations">3.5  Deployment Considerations</h3>
<h3 id="36-evaluation-of-scalerpc">3.6  Evaluation of ScaleRPC</h3>
<h4 id="361-experimental-setup">3.6.1  Experimental Setup</h4>
<h4 id="362-overall-performance">3.6.2  Overall Performance</h4>
<p>æ¯”è¾ƒäº†ä¸åŒRPCç³»ç»Ÿçš„throughputã€latencyã€‚å‘ç°ScaleRPCè¡¨ç°å¾—æœ€é«˜ï¼Œé™¤äº†ä¼šäº§ç”Ÿtail lantencyã€‚</p>
<h4 id="363-analysis-of-internal-mechanisms">3.6.3  Analysis of Internal Mechanisms</h4>
<h4 id="364-analysis-of-uniform-workloads">3.6.4  Analysis of Uniform Workloads</h4>
<ol>
<li>åˆ†æäº†æ—¶é—´ç‰‡å¤§å°çš„é€‰æ‹©ã€‚å¤ªå°çš„è¯ï¼Œç»„åˆ‡æ¢é¢‘ç¹ï¼Œå¼€é”€å˜å¤§ï¼›å¤ªå¤§çš„è¯ï¼Œtail latencyä¼šå˜å¤§ï¼ˆå› ä¸ºç½‘ç»œä¸é¥±å’Œï¼‰ã€‚</li>
<li>åˆ†æäº†ç»„å¤§å°çš„é€‰æ‹©ã€‚å¤ªå°çš„è¯ï¼Œç½‘ç»œä¸é¥±å’Œï¼Œthroughputæ— æ³•è¾¾åˆ°æœ€å¤§ï¼›å¤ªå¤§çš„è¯ï¼Œèµ„æºå†²çªã€‚</li>
</ol>
<h4 id="365-analysis-of-non-uniform-workloads">3.6.5  Analysis of Non-uniform Workloads</h4>
<p>é€šè¿‡å¯åŠ¨æ‹¥æœ‰ä¸åŒè®¿é—®é¢‘ç‡çš„clientsæ¥æµ‹è¯•åœ¨ä¸å¹³è¡¡è´Ÿè½½ä¸‹ScaleRPCä¸­ä¼˜å…ˆçº§è°ƒåº¦äº§ç”Ÿçš„æ•ˆæœã€‚æœ€ç»ˆå‘ç°åŠ¨æ€å‹ScaleRPCï¼ˆæ—¶é—´ç‰‡å¤§å°å’Œç»„å¤§å°æ ¹æ®ä¼˜å…ˆçº§åŠ¨æ€å˜åŒ–ï¼‰æ¯”é™æ€å‹è¡¨ç°æ›´å¥½ã€‚</p>
<h2 id="4-deployments-of-scalerpc">4  Deployments of ScaleRPC</h2>
<h3 id="41-scalerpc-in-distributed-file-system">4.1  ScaleRPC in Distributed File System</h3>
<p>å°†Octopusä¸­çš„RPCå­ç³»ç»Ÿæ›¿æ¢ä¸ºScaleRPCï¼Œç»“æœè¡¨æ˜ScaleRPCæ¯”åŸæ¥çš„RPCè¡¨ç°æ›´å¥½</p>
<h3 id="42-scalerpc-in-transactional-system">4.2  ScaleRPC in Transactional System</h3>
<p>å°†è¿™æ ·ä¸€ä¸ªç³»ç»Ÿç§°ä¸ºScaleTXã€‚<br>
ä¸€ä¸ªtransactional Systemæœ‰è‹¥å¹²ä¸ªcoordinatorsä½œä¸ºclientsï¼Œæœ‰è‹¥å¹²ä¸ªparticipantsä½œä¸ºserversã€‚clientså‘èµ· transactional requestsï¼Œserversç»´æŠ¤ä¸€ä¸ªkey-value storeã€‚è¿™æ˜¯ä¸€ä¸ªmany-to-manyç³»ç»Ÿï¼Œä½†æ˜¯ScaleRPCåªé’ˆå¯¹one-to-manyã€‚è¿™é‡Œçš„è§£å†³æ–¹æ³•æ˜¯ï¼Œè®©å‡ ä¸ªserversåŒæ­¥ä¸€ä¸‹ï¼Œä»¥ç›¸åŒçš„paceåˆ‡æ¢client groupsï¼ˆä»¥å…¶ä¸­ä¸€ä¸ªserverä¸ºåŸºå‡†ï¼‰ã€‚<br>
äº‹åŠ¡ç³»ç»Ÿä¸­çš„validateç”¨åˆ°äº†RDMA readï¼Œcommitç”¨åˆ°äº†RDMA writeã€‚</p>
<h4 id="421-evaluation-of-scaletx">4.2.1  Evaluation of ScaleTX</h4>
<p>ç”¨è¯»å¯†é›†å‹çš„Object Storeå’Œå†™å¯†é›†å‹çš„SmallBankåˆ†åˆ«è¿›è¡Œå®éªŒã€‚åŒæ ·å’Œå…¶å®ƒRPCçš„æ•ˆæœä¸€èµ·æ¯”è¾ƒã€‚<br>
å…¶ä¸­è¿˜å•ç‹¬æ¯”è¾ƒäº†ScaleTX-Oï¼ˆå–æ¶ˆäº†å•è¾¹verbsï¼‰å’ŒScaleTXã€‚å‘ç°åœ¨å†™å¯†é›†å‹ä¸­ï¼ŒScaleTXè¡¨ç°æ›´å¥½ï¼ˆè¯´æ˜äº†RDMA writeçš„å¥½å¤„ï¼‰ã€‚</p>
<h2 id="5-discussion">5  Discussion</h2>
<ol>
<li>è™½ç„¶UDå‹RDMAæœ‰å¾ˆå¥½çš„scalabilityï¼Œä½†æ˜¯å®ƒä¸æ”¯æŒå•è¾¹verbsï¼Œå¹¶ä¸”MTUå¾ˆå°ã€‚</li>
<li>DCTæ–¹æ³•ï¼Œç›¸æ¯”èµ·æ¥è´Ÿè½½doubleäº†ã€‚</li>
<li>ScaledRPCï¼šä½¿ç”¨RCã€å•è¾¹verbsã€æå‡äº†scalabilityã€‚</li>
</ol>
<h2 id="é—®é¢˜">é—®é¢˜</h2>
<ol>
<li>Dynamically Connected Transport(DCT)</li>
<li>RDMAä¸­write_immå’Œatomic</li>
<li>LLCæ˜¯ä¸æ˜¯å°±æ˜¯æ•°æ®å­˜æ”¾çš„memory region</li>
<li>PCIe events</li>
<li>DDIO(Data Direct I/O)</li>
<li>è®ºæ–‡ä¸­æ‰€è°“çš„Virtualized mappingä»”ç»†ä¸€æƒ³å¥½åƒå°±æ˜¯ç®€å•çš„è¦†ç›–å¡«å†™ï¼Ÿ</li>
<li>tail lantencyçš„åŸå› ï¼Ÿåä¸€å¹…å›¾ç½‘ç»œé¥±å’Œï¼Œæ˜¯ç”±äºæ—¶é—´ç‰‡çš„ç»„åˆ‡æ¢å¯¼è‡´çš„tail lantencyï¼Ÿå‰ä¸€å¹…å›¾ç½‘ç»œæœªé¥±å’Œæ—¶ä»€ä¹ˆæ„æ€ï¼Ÿ<br>
ç­”ï¼šå°±æ˜¯æ—¶é—´ç‰‡å¤§å°åå¤§äº†ï¼Œå¯¼è‡´requestè¢«å¤„ç†å®Œåå’Œåœ¨ç»„åˆ‡æ¢ä¹‹é—´å­˜åœ¨äº†ä¸€æ®µæ—¶é—´çš„æµªè´¹ã€‚</li>
</ol>

					</div>
				</article>
			</div>
			<div class="toc-container">
				<ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#0-abstract">0 Abstract</a></li>
<li><a href="#1-introduction">1 Introduction</a></li>
<li><a href="#2-background-and-motivation">2 Background and Motivation</a>
<ul>
<li><a href="#21-rdma">2.1 RDMA</a></li>
<li><a href="#22-poor-scalability-of-rdma">2.2 Poor Scalability of RDMA</a></li>
<li><a href="#resource-contention-in-rdma">Resource Contention in RDMA</a></li>
</ul>
</li>
<li><a href="#3-scalerpc">3 ScaleRPC</a>
<ul>
<li><a href="#31-overview">3.1 Overview</a></li>
<li><a href="#32-connection-grouping">3.2  Connection Grouping</a></li>
<li><a href="#33-virtualized-mapping">3.3  Virtualized Mapping</a></li>
<li><a href="#34-putting-everything-together%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B">3.4  Putting Everything Togetherï¼ˆæ•´ä½“æµç¨‹ï¼‰</a></li>
<li><a href="#35-deployment-considerations">3.5  Deployment Considerations</a></li>
<li><a href="#36-evaluation-of-scalerpc">3.6  Evaluation of ScaleRPC</a>
<ul>
<li><a href="#361-experimental-setup">3.6.1  Experimental Setup</a></li>
<li><a href="#362-overall-performance">3.6.2  Overall Performance</a></li>
<li><a href="#363-analysis-of-internal-mechanisms">3.6.3  Analysis of Internal Mechanisms</a></li>
<li><a href="#364-analysis-of-uniform-workloads">3.6.4  Analysis of Uniform Workloads</a></li>
<li><a href="#365-analysis-of-non-uniform-workloads">3.6.5  Analysis of Non-uniform Workloads</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#4-deployments-of-scalerpc">4  Deployments of ScaleRPC</a>
<ul>
<li><a href="#41-scalerpc-in-distributed-file-system">4.1  ScaleRPC in Distributed File System</a></li>
<li><a href="#42-scalerpc-in-transactional-system">4.2  ScaleRPC in Transactional System</a>
<ul>
<li><a href="#421-evaluation-of-scaletx">4.2.1  Evaluation of ScaleTX</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#5-discussion">5  Discussion</a></li>
<li><a href="#%E9%97%AE%E9%A2%98">é—®é¢˜</a></li>
</ul>
</li>
</ul>

			</div>
		</div>

        

        

        
            
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
    // md5.min.js
    !function(n){
        "use strict";
        function d(n,t){var r=(65535&n)+(65535&t);return(n>>16)+(t>>16)+(r>>16)<<16|65535&r}
        function f(n,t,r,e,o,u){return d((c=d(d(t,n),d(e,u)))<<(f=o)|c>>>32-f,r);var c,f}
        function l(n,t,r,e,o,u,c){return f(t&r|~t&e,n,t,o,u,c)}
        function v(n,t,r,e,o,u,c){return f(t&e|r&~e,n,t,o,u,c)}
        function g(n,t,r,e,o,u,c){return f(t^r^e,n,t,o,u,c)}
        function m(n,t,r,e,o,u,c){return f(r^(t|~e),n,t,o,u,c)}
        function i(n,t){var r,e,o,u,c;n[t>>5]|=128<<t%32,n[14+(t+64>>>9<<4)]=t;var f=1732584193,i=-271733879,a=-1732584194,h=271733878;for(r=0;r<n.length;r+=16)f=l(e=f,o=i,u=a,c=h,n[r],7,-680876936),h=l(h,f,i,a,n[r+1],12,-389564586),a=l(a,h,f,i,n[r+2],17,606105819),i=l(i,a,h,f,n[r+3],22,-1044525330),f=l(f,i,a,h,n[r+4],7,-176418897),h=l(h,f,i,a,n[r+5],12,1200080426),a=l(a,h,f,i,n[r+6],17,-1473231341),i=l(i,a,h,f,n[r+7],22,-45705983),f=l(f,i,a,h,n[r+8],7,1770035416),h=l(h,f,i,a,n[r+9],12,-1958414417),a=l(a,h,f,i,n[r+10],17,-42063),i=l(i,a,h,f,n[r+11],22,-1990404162),f=l(f,i,a,h,n[r+12],7,1804603682),h=l(h,f,i,a,n[r+13],12,-40341101),a=l(a,h,f,i,n[r+14],17,-1502002290),f=v(f,i=l(i,a,h,f,n[r+15],22,1236535329),a,h,n[r+1],5,-165796510),h=v(h,f,i,a,n[r+6],9,-1069501632),a=v(a,h,f,i,n[r+11],14,643717713),i=v(i,a,h,f,n[r],20,-373897302),f=v(f,i,a,h,n[r+5],5,-701558691),h=v(h,f,i,a,n[r+10],9,38016083),a=v(a,h,f,i,n[r+15],14,-660478335),i=v(i,a,h,f,n[r+4],20,-405537848),f=v(f,i,a,h,n[r+9],5,568446438),h=v(h,f,i,a,n[r+14],9,-1019803690),a=v(a,h,f,i,n[r+3],14,-187363961),i=v(i,a,h,f,n[r+8],20,1163531501),f=v(f,i,a,h,n[r+13],5,-1444681467),h=v(h,f,i,a,n[r+2],9,-51403784),a=v(a,h,f,i,n[r+7],14,1735328473),f=g(f,i=v(i,a,h,f,n[r+12],20,-1926607734),a,h,n[r+5],4,-378558),h=g(h,f,i,a,n[r+8],11,-2022574463),a=g(a,h,f,i,n[r+11],16,1839030562),i=g(i,a,h,f,n[r+14],23,-35309556),f=g(f,i,a,h,n[r+1],4,-1530992060),h=g(h,f,i,a,n[r+4],11,1272893353),a=g(a,h,f,i,n[r+7],16,-155497632),i=g(i,a,h,f,n[r+10],23,-1094730640),f=g(f,i,a,h,n[r+13],4,681279174),h=g(h,f,i,a,n[r],11,-358537222),a=g(a,h,f,i,n[r+3],16,-722521979),i=g(i,a,h,f,n[r+6],23,76029189),f=g(f,i,a,h,n[r+9],4,-640364487),h=g(h,f,i,a,n[r+12],11,-421815835),a=g(a,h,f,i,n[r+15],16,530742520),f=m(f,i=g(i,a,h,f,n[r+2],23,-995338651),a,h,n[r],6,-198630844),h=m(h,f,i,a,n[r+7],10,1126891415),a=m(a,h,f,i,n[r+14],15,-1416354905),i=m(i,a,h,f,n[r+5],21,-57434055),f=m(f,i,a,h,n[r+12],6,1700485571),h=m(h,f,i,a,n[r+3],10,-1894986606),a=m(a,h,f,i,n[r+10],15,-1051523),i=m(i,a,h,f,n[r+1],21,-2054922799),f=m(f,i,a,h,n[r+8],6,1873313359),h=m(h,f,i,a,n[r+15],10,-30611744),a=m(a,h,f,i,n[r+6],15,-1560198380),i=m(i,a,h,f,n[r+13],21,1309151649),f=m(f,i,a,h,n[r+4],6,-145523070),h=m(h,f,i,a,n[r+11],10,-1120210379),a=m(a,h,f,i,n[r+2],15,718787259),i=m(i,a,h,f,n[r+9],21,-343485551),f=d(f,e),i=d(i,o),a=d(a,u),h=d(h,c);return[f,i,a,h]}
        function a(n){var t,r="",e=32*n.length;for(t=0;t<e;t+=8)r+=String.fromCharCode(n[t>>5]>>>t%32&255);return r}
        function h(n){var t,r=[];for(r[(n.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;var e=8*n.length;for(t=0;t<e;t+=8)r[t>>5]|=(255&n.charCodeAt(t/8))<<t%32;return r}
        function e(n){var t,r,e="0123456789abcdef",o="";for(r=0;r<n.length;r+=1)t=n.charCodeAt(r),o+=e.charAt(t>>>4&15)+e.charAt(15&t);return o}
        function r(n){return unescape(encodeURIComponent(n))}
        function o(n){return a(i(h(t=r(n)),8*t.length));var t}
        function u(n,t){return function(n,t){var r,e,o=h(n),u=[],c=[];for(u[15]=c[15]=void 0,16<o.length&&(o=i(o,8*n.length)),r=0;r<16;r+=1)u[r]=909522486^o[r],c[r]=1549556828^o[r];return e=i(u.concat(h(t)),512+8*t.length),a(i(c.concat(e),640))}(r(n),r(t))}
        function t(n,t,r){return t?r?u(t,n):e(u(t,n)):r?o(n):e(o(n))}
        "function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:n.md5=t;
    }(this);
</script>


<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '5abd65b568c1e2c6b800',
    clientSecret: '3921f7376ba20307d009be645bee2ae1466ed990',
    repo: 'River861.github.io',
    owner: 'River861',
    admin: ['River861'],
    id: md5(location.pathname),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false       // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

            

            
        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">Re: start</div>
    <div class="social-container">
        
            
                <a href="https://github.com/River861" target="_blank">
                    <i class="fab fa-github gt-c-content-color-first"></i>
                </a>
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Copyright Â© 2020  <a href="https://github.com/River861" target="_blank">River</a>
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="https://river861.github.io/atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>

</body>
</html>
